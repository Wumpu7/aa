<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECSR Robux Giveaway</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(to right, #6dd5ed, #2193b0);
            margin: 0;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        input[type="text"] {
            width: 80%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
        }
        button {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #218838;
        }
        #profile-image, #pfp-preview {
            margin-top: 20px;
            border-radius: 8px;
            max-width: 100%;
            height: auto;
        }
        .loading-bar {
            margin: 20px auto;
            width: 100%;
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        .loading-progress {
            height: 100%;
            width: 0;
            background-color: #007bff;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>ECSR Robux Giveaway</h1>
    <p>Enter your Roblox User ID to participate:</p>
    <input type="text" id="robloxUserId" placeholder="Your Roblox User ID">
    <button id="participateButton">Participate</button>

    <div id="verificationStep" style="display: none;">
        <h2>Is this you? (wait for image)</h2>
        <div class="loading-bar"><div class="loading-progress" id="loadingBar"></div></div>
        <img id="pfp-preview" src="" alt="Avatar Headshot Preview">
        <img id="profile-image" src="" alt="Roblox Profile Image">
        <button id="yesButton">Yes, that's me!</button>
        <button id="noButton">No, wrong ID</button>
    </div>

    <div id="rouletteStep" style="display: none;">
        <h2>Will you get Robux?</h2>
        <p id="riggedSpin"></p>
        <h2 style="display: none;" id="doublePrizeStep">Get 2x prize?</h2>
        <p id="doubleResult"></p>
        <p id="rouletteResult"></p>
    </div>

    <div id="tshirtLinkStep" style="display: none;">
        <h2>You won <span id="wonRobuxAmount"></span> Robux!</h2>
        <p>Please provide a link to a Roblox T-Shirt (or shirt/pants) with the exact price of <span id="requiredPrice"></span> Robux.</p>
        <input type="text" id="tshirtLink" placeholder="T-Shirt Link">
        <button id="submitTshirt">Submit T-Shirt</button>
    </div>
</div>

<script>
    document.getElementById('participateButton').addEventListener('click', async () => {
        const userId = document.getElementById('robloxUserId').value;
        if (!userId) return alert('Enter your Roblox User ID.');

        document.getElementById('verificationStep').style.display = 'block';

        const pfpRes = await fetch(`https://ecsr.io/apisite/thumbnails/v1/users/avatar-headshot?userIds=${userId}`);
        const pfpData = await pfpRes.json();
        const imgUrl = "https://ecsr.io" + pfpData.data[0].imageUrl;
        document.getElementById('pfp-preview').src = imgUrl;

        const loading = document.getElementById('loadingBar');
        let percent = 0;
        const loader = setInterval(() => {
            percent += 5;
            loading.style.width = percent + '%';
            if (percent >= 100) clearInterval(loader);
        }, 200);

        const profileImageUrl = `https://api.apiflash.com/v1/urltoimage?access_key=91aeaa0c407e4f089e1c49af78437242&url=https%3A%2F%2Fecsr.io%2Fusers%2F${userId}%2Fprofile&format=png&delay=8&response_type=image`;
        document.getElementById('profile-image').src = profileImageUrl;

        sessionStorage.setItem('currentUserId', userId);
    });

    document.getElementById('yesButton').addEventListener('click', () => {
        document.getElementById('verificationStep').style.display = 'none';
        document.getElementById('rouletteStep').style.display = 'block';
        runRiggedSpin();
    });

    document.getElementById('noButton').addEventListener('click', () => {
        document.getElementById('verificationStep').style.display = 'none';
        document.getElementById('robloxUserId').value = '';
    });

    let wonRobux = 0;

    function runRiggedSpin() {
        const spinMsg = document.getElementById('riggedSpin');
        spinMsg.innerText = 'Spinning...';
        setTimeout(() => {
            spinMsg.innerText = 'Yes! You will get Robux!';
            runDoubleChance();
        }, 2000);
    }

    function runDoubleChance() {
        const doubleText = document.getElementById('doubleResult');
        const doubleStep = document.getElementById('doublePrizeStep');
        doubleStep.style.display = 'block';
        setTimeout(() => {
            doubleText.innerText = 'Congratulations! You got 2x Robux!';
            // Rigged reward calculation
            const fullPrize = Math.floor(Math.random() * (90 - 10 + 1)) + 10;
            wonRobux = Math.floor(fullPrize / 2); // Always half even if 2x
            document.getElementById('rouletteResult').innerText = `Your reward: ${wonRobux} Robux`;
            document.getElementById('wonRobuxAmount').innerText = wonRobux;
            document.getElementById('requiredPrice').innerText = wonRobux;
            document.getElementById('tshirtLinkStep').style.display = 'block';
            document.getElementById('rouletteStep').style.display = 'none';
        }, 2000);
    }
</script>
</body>
</html>
